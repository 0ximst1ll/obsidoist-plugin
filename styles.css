.obsidoist-list {
    display: flex;
    flex-direction: column;
    width: 100%;
    /* Ensure relative positioning for absolute children if needed */
    position: relative;
}

/* 
   CLEAN HEADER IMPLEMENTATION
   Uses flexbox to separate title (left) and controls (right).
   UPDATED: Using flex-end to ensure controls are always on the right even if title is empty.
*/
.obsidoist-header {
    display: flex;
    justify-content: flex-end; /* Force everything to the right by default */
    align-items: center;
    width: 100%; /* Ensure header takes full width */
    
    /* Optional: minimal height to look like a toolbar */
    min-height: 30px;
    margin-bottom: 8px;
    
    /* Ensure pointer events work */
    pointer-events: auto;
}

.obsidoist-title {
    font-weight: 600;
    color: var(--text-normal);
    /* Push controls to the right if title exists */
    margin-right: auto; 
    padding-right: 8px;
}

.obsidoist-controls {
    display: flex;
    align-items: center;
    gap: 4px; /* Space between buttons */
    /* Double insurance to push right */
    margin-left: auto;
}

/* 
   We STILL need to hide the native button because we are providing our own UI.
*/
.obsidoist-code-block-wrap .edit-block-button,
.obsidoist-code-block-wrap > .edit-block-button,
.obsidoist-code-block-wrap > div > .edit-block-button,
.cm-preview-code-block.obsidoist-code-block-wrap > .edit-block-button {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    width: 0 !important;
    height: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
}

.code-block-wrap:has(.obsidoist-list) .edit-block-button,
.cm-preview-code-block:has(.obsidoist-list) .edit-block-button {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    width: 0 !important;
    height: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
}

.obsidoist-refresh-btn, .obsidoist-edit-btn {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    outline: none !important;
    padding: 4px;
    cursor: pointer;
    color: var(--text-muted);
    border-radius: 4px;
    
    /* Reset layout properties */
    display: flex;
    align-items: center;
    justify-content: center;
    appearance: none;
    -webkit-appearance: none;
    position: static !important;

    /* Hidden by default */
    opacity: 0;
    pointer-events: none;
    
    /* Instant FADE OUT (No delay) */
    transition: opacity 0s;
}

/* VISIBILITY RULES: */
/* 1. Show when hovering the parent code block wrapper (synced) */
.obsidoist-code-block-wrap:hover .obsidoist-refresh-btn,
.obsidoist-code-block-wrap:hover .obsidoist-edit-btn {
    opacity: 1;
    pointer-events: auto;
    transition: opacity 0s;
}

/* 2. Show when hovering the header itself (Direct parent backup) */
/* This fixes the issue where hovering the edit button (child of controls) might lose wrapper context */
.obsidoist-header:hover .obsidoist-refresh-btn,
.obsidoist-header:hover .obsidoist-edit-btn,
.obsidoist-controls:hover .obsidoist-refresh-btn,
.obsidoist-controls:hover .obsidoist-edit-btn {
    opacity: 1 !important;
    pointer-events: auto;
    transition: opacity 0s;
}

/* Fallback: also show on list hover just in case parent class fails */
.obsidoist-list:hover .obsidoist-refresh-btn,
.obsidoist-list:hover .obsidoist-edit-btn {
    opacity: 1;
    pointer-events: auto;
    transition: opacity 0s;
}

/* Also force visibility if it is spinning/loading */
.obsidoist-refresh-btn.obsidoist-spinning {
    opacity: 1 !important;
    pointer-events: auto;
    transition: none !important; /* Keep it visible without transition */
}

.obsidoist-refresh-btn:hover, .obsidoist-edit-btn:hover {
    background-color: var(--background-modifier-hover) !important;
    color: var(--text-normal);
}

.obsidoist-refresh-btn:focus, .obsidoist-edit-btn:focus {
    box-shadow: none !important;
}

/* Use custom class for spinning to avoid theme conflicts */
.obsidoist-refresh-btn.obsidoist-spinning svg {
    animation: obsidoist-spin 1s linear infinite;
}

/* Ensure no background on our custom spinning class either */
/* Redundant safety: also remove background on is-loading just in case */
.obsidoist-refresh-btn.is-loading,
.obsidoist-refresh-btn.obsidoist-spinning,
.obsidoist-edit-btn {
    background-image: none !important;
    background-color: transparent !important;
}

@keyframes obsidoist-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.obsidoist-list-container ul {
    margin: 0;
    padding: 0;
    list-style: none;
}

.obsidoist-list-container li {
    display: flex;
    align-items: flex-start;
    padding: 4px 0;
    gap: 8px;
}

.obsidoist-list-container li.is-checked span {
    text-decoration: line-through;
    color: var(--text-muted);
}

.obsidoist-footer {
    margin-top: 12px;
    padding-top: 8px;
    /* Remove top border */
    /* border-top: 1px solid var(--background-modifier-border); */
    font-size: 0.85em;
    color: var(--text-muted);
    /* Change alignment to left */
    text-align: left;
}

.obsidoist-error {
    color: var(--text-error);
    padding: 8px;
    background-color: var(--background-primary-alt);
    border-radius: 4px;
}
